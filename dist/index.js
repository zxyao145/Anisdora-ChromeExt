!function(){const api="https://cdn.jsdelivr.net/gh/zxyao145/awesome-websites/list.json",appName=" ",localStorageVersionKey=" _update",localStorageFullDataKey=" _data",localStorageDiffDataKey=" _diff_data";function handleResJson(msg,tab){const version=msg.update,lastVersion=localStorage.getItem(" _update");if(lastVersion)if(lastVersion===version){const jsonStr=JSON.stringify(msg.data);localStorage.setItem(" _data",jsonStr),localStorage.setItem(" _diff_data",jsonStr),randomJump(msg.data,tab)}else{const lastData=JSON.parse(localStorage.getItem(" _data")),curDataDiff=Array.from(new Set(msg.data));for(let i=0;i<lastData.length;i++){let index=curDataDiff.indexOf(lastData[i]);index>0&&curDataDiff.splice(index,1)}localStorage.setItem(" _data",JSON.stringify(msg.data)),localStorage.setItem(" _diff_data",JSON.stringify(curDataDiff)),randomJump(curDataDiff,tab)}else{localStorage.setItem(" _update",version);const jsonStr=JSON.stringify(msg.data);localStorage.setItem(" _data",jsonStr),localStorage.setItem(" _diff_data",jsonStr),randomJump(msg.data,tab)}}let timeout=-1,lastClickTime;function randomJump(dataArr,tab){const randomIndex=Math.floor(Math.random()*dataArr.length),info=dataArr[randomIndex];let url=info[0];url||(url=info.url),dataArr.splice(randomIndex,1),localStorage.setItem(" _diff_data",JSON.stringify(dataArr)),chrome.tabs.update(tab.id,{url:url}),-1!==timeout&&window.clearTimeout(timeout),timeout=setTimeout(()=>{chrome.browserAction.setIcon({path:{19:"images/logo-19.png",38:"images/logo-38.png"}}),timeout=-1},500)}function queryData(tab){const xmlHttp=new XMLHttpRequest;xmlHttp.overrideMimeType&&xmlHttp.overrideMimeType("application/text"),xmlHttp.onreadystatechange=function(){if(4==xmlHttp.readyState&&200==xmlHttp.status){const msgText=xmlHttp.responseText,msg=JSON.parse(msgText);handleResJson(msg,tab)}},xmlHttp.ontimeout=function(){alert("  请求超时，无法获取随机网站。\n  request timed out, unable to get the random website")},xmlHttp.onerror=function(e){console.error(e),alert("  请求发生错误，无法获取随机网站。\n  an error occurred, unable to get the random website")},xmlHttp.timeout=1e4,xmlHttp.open("GET",api,!0),xmlHttp.send(null)}chrome.browserAction.onClicked.addListener((function(tab){-1===timeout&&chrome.browserAction.setIcon({path:{19:"images/logo-h-19.png",38:"images/logo-h-38.png"}});const timeNow=Date.now();if(lastClickTime&&timeNow-lastClickTime<500)return void(lastClickTime=timeNow);lastClickTime=timeNow;const storageDataCache=JSON.parse(localStorage.getItem(" _diff_data"));storageDataCache&&storageDataCache.length>0?randomJump(storageDataCache,tab):queryData(tab)}))}();